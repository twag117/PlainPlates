{% extends "base.html" %}
{% block title %}{{ recipe.title }}{% endblock %}

{% block content %}
<section class="max-w-4xl mx-auto px-4 py-8">
    <a href="/recipes"
        class="text-sm text-primary-600 hover:underline inline-block mb-4 -mt-5">
        ← Back to All Recipes
    </a>

    <h1 class="text-3xl font-bold mb-2">{{ recipe.title }}</h1>
    <form method="post" action="/favorites/{{ recipe.id }}" class="mb-4">
        <button type="submit"
            class="text-sm text-primary-600 hover:underline">
            {% if is_favorited %}
                💔 Remove from Favorites
            {% else %}
                ❤️ Add to Favorites
            {% endif %}
        </button>
    </form>


    <p class="text-gray-600 mb-4">{{ recipe.description }}</p>

    <div class="mb-6 rounded overflow-hidden">
        <img src="/static/images/recipes{{ recipe.slug }}.jpg"
            onerror="this.onerror=null;this.src='https://placehold.co/400x200?text=Image Coming Soon'; this.classList.add('h-16');"
            alt="{{ recipe.title }}"
            class="w-full h-64 object-cover rounded">
    </div>

    <div class="flex items-center justify-between text-sm text-gray-500 mb-6">
        <span>Total Time: {{ recipe.prep_time + recipe.cook_time }} min</span>
        <!-- <span>Score: {% if recipe.score > 0 %}🔥{% else %}🧊{% endif %} {{ recipe.score }}</span> -->
    

<div class="flex items-center gap-4 mb-6">
  <form method="post" action="/recipes/{{ recipe.id }}/vote">
    <input type="hidden" name="value" value="1">
    <button type="submit"
            class="flex items-center gap-1 text-sm px-2 py-1 rounded
                   {% if vote == 1 %}bg-green-100 text-green-700{% else %}text-gray-600 hover:text-green-600{% endif %}">
      👍 {{ recipe.score }}
    </button>
  </form>

  <form method="post" action="/recipes/{{ recipe.id }}/vote">
    <input type="hidden" name="value" value="-1">
    <button type="submit"
            class="text-sm px-2 py-1 rounded
                   {% if vote == -1 %}bg-red-100 text-red-600{% else %}text-gray-600 hover:text-red-600{% endif %}">
      👎
    </button>
  </form>
</div>
</div>


    {% if recipe.tags %}
    <div class="flex flex-wrap gap-2 mb-6">
        {% for tag in recipe.tags %}
        <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-xs">{{ tag }}</span>
        {% endfor %}
    </div>
    {% endif %}

    <div class="flex items-center gap-2 mb-6">
        <input type="checkbox" id="keep-awake" class="w-4 h-4">
        <label for="keep-awake" class="text-sm text-gray-600">
        Keep screen awake while viewing this recipe
        </label>
    </div>


    <h2 class="text-xl font-semibold mb-2">Ingredients</h2>
    <pre class="bg-gray-50 p-4 rounded text-sm whitespace-pre-wrap mb-6">{{ recipe.ingredients }}</pre>

    <h2 class="text-xl font-semibold mb-2">Instructions</h2>
    <pre class="bg-gray-50 p-4 rounded text-sm whitespace-pre-wrap mb-6">{{ recipe.instructions }}</pre>

    {% if recipe.notes %}
    <h2 class="text-xl font-semibold mb-2">Notes</h2>
    <pre class="bg-gray-50 p-4 rounded text-sm whitespace-pre-wrap">{{ recipe.notes }}</pre>
    {% endif %}
</section>

<script>
let wakeLock = null;

async function requestWakeLock() {
  try {
    wakeLock = await navigator.wakeLock.request('screen');
    console.log('🔓 Wake lock is active');
  } catch (err) {
    console.error('Wake lock error:', err);
  }
}

function releaseWakeLock() {
  if (wakeLock !== null) {
    wakeLock.release().then(() => {
      console.log('🔒 Wake lock released');
      wakeLock = null;
    });
  }
}

document.getElementById('keep-awake').addEventListener('change', (e) => {
  if ('wakeLock' in navigator) {
    if (e.target.checked) {
      requestWakeLock();
    } else {
      releaseWakeLock();
    }
  } else {
    alert('Your device does not support screen wake lock.');
  }
});
</script>
{% endblock %}
